<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vienna Trip Navigator ‚Äì VIE ‚Üí Das Tigra</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <style>
    html, body { height: 100%; margin:0; padding:0; }
    #map { height: 65vh; width:100%; }
    .btn { padding: 0.5rem 1rem; border-radius: 0.75rem; font-weight: 600; box-shadow: 0 1px 2px rgba(0,0,0,0.05); transition: transform .05s ease; display:inline-flex; align-items:center; gap:.4rem; cursor:pointer }
    .btn:active { transform: scale(0.98); }
    .card { background: rgba(255,255,255,0.9); border-radius: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
    .chip { font-size: 12px; padding: 2px 8px; border-radius: 999px; border: 1px solid #e2e8f0; }
  </style>
</head>
<body style="font-family:sans-serif; background:#f8fafc; color:#1e293b;">
  <header style="background:#4f46e5; color:white; padding:1rem;">
    <h1 style="margin:0; font-size:1.5rem;">Vienna Trip Navigator</h1>
    <p style="margin:0.3rem 0 0;">Aeroporto di Vienna (VIE) ‚Üí Boutique Hotel Das Tigra + monumenti e fast food</p>
  </header>

  <section style="padding:1rem;">
    <div class="card" style="padding:1rem; margin-bottom:1rem;">
      <h2 style="margin-top:0">Vai all'hotel</h2>
      <div style="display:flex; flex-wrap:wrap; gap:0.5rem;">
        <a class="btn" style="background:#4f46e5; color:white;" target="_blank" href="https://www.google.com/maps/dir/?api=1&origin=Vienna+International+Airport&destination=Boutique+Hotel+Das+Tigra+Vienna&travelmode=transit">üöá Trasporto pubblico</a>
        <a class="btn" style="background:#059669; color:white;" target="_blank" href="https://www.google.com/maps/dir/?api=1&origin=Vienna+International+Airport&destination=Boutique+Hotel+Das+Tigra+Vienna&travelmode=driving">üöï Auto/Taxi</a>
        <a class="btn" style="background:#0ea5e9; color:white;" target="_blank" href="https://www.google.com/maps/dir/?api=1&origin=Vienna+International+Airport&destination=Boutique+Hotel+Das+Tigra+Vienna&travelmode=walking">üö∂ A piedi</a>
      </div>
    </div>

    <div class="card" style="padding:1rem; margin-bottom:1rem;">
      <label><input type="checkbox" id="toggleMonuments" checked> Mostra monumenti</label>
      <label style="margin-left:1rem;"><input type="checkbox" id="toggleFastFood" checked> Mostra fast food</label>
      <button id="fetchFastFoodBtn" class="btn" style="background:#f59e0b; color:white; margin-left:1rem;">üçî Carica fast food nell'area</button>
    </div>

    <div style="display:grid; grid-template-columns:2fr 1fr; gap:1rem;">
      <div class="card"><div id="map"></div></div>
      <div class="card" style="padding:1rem; overflow:auto; max-height:65vh;">
        <h3>Cosa vedere</h3>
        <div id="poiList"></div>
      </div>
    </div>
  </section>

  <script>
  (function(){
    // Helper: show error in sidebar if something fails
    function showError(msg){
      try{
        const list=document.getElementById('poiList');
        if(list){
          const div=document.createElement('div');
          div.style.cssText='margin:.5rem 0;padding:.5rem;border:1px solid #fecaca;background:#fff1f2;color:#7f1d1d;border-radius:.5rem;font-size:.9rem';
          div.textContent=msg;
          list.prepend(div);
        }
      }catch(_){/* noop */}
      console.error(msg);
    }

    // Check Leaflet loaded
    if(typeof L==='undefined'){
      showError('Errore: la libreria mappe non √® stata caricata (Leaflet). Assicurati di essere online e che l\'hosting non blocchi unpkg.com');
      return;
    }

    function makeIcon(color){
      var svg = encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'><circle cx='12' cy='12' r='10' fill='"+color+"'/></svg>");
      return L.icon({iconUrl:'data:image/svg+xml,'+svg,iconSize:[24,24],iconAnchor:[12,12]});
    }
    var iconMonument = makeIcon('#3b82f6');
    var iconFastFood = makeIcon('#f59e0b');
    var iconHotel = makeIcon('#10b981');

    var map;
    try{
      map = L.map('map').setView([48.2082,16.3738],13);
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap'}).addTo(map);
      // forza layout su alcuni host
      setTimeout(function(){ try{ map.invalidateSize(); }catch(_){ } }, 300);
      window.addEventListener('resize', function(){ try{ map.invalidateSize(); }catch(_){ } });
    }catch(e){
      showError('Impossibile inizializzare la mappa: '+e.message);
      return;
    }

    // Hotel
    L.marker([48.2127,16.3717],{icon:iconHotel}).addTo(map).bindPopup('Boutique Hotel Das Tigra');

    // Layer groups
    var layerMonuments=L.layerGroup().addTo(map);
    var layerFastFood=L.layerGroup().addTo(map);

    var POIS=[
      {name:'Stephansdom',lat:48.2084,lng:16.3731,desc:'Cattedrale gotica',paid:false},
      {name:'Hofburg',lat:48.2065,lng:16.3656,desc:'Palazzo imperiale',paid:true},
      {name:'Sch√∂nbrunn',lat:48.1845,lng:16.3122,desc:'Residenza estiva',paid:true},
      {name:'Belvedere',lat:48.1913,lng:16.3805,desc:'Museo con Klimt',paid:true},
      {name:'Prater Riesenrad',lat:48.2165,lng:16.3956,desc:'Ruota panoramica',paid:true}
    ];

    function addMonuments(){
      layerMonuments.clearLayers();
      for(var i=0;i<POIS.length;i++){
        var p=POIS[i];
        L.marker([p.lat,p.lng],{icon:iconMonument}).addTo(layerMonuments).bindPopup('<b>'+p.name+'</b><br>'+p.desc+(p.paid?' <span style="color:#b91c1c">(a pagamento)</span>':' <span style="color:#15803d">(gratis)</span>'));
      }
    }
    addMonuments();

    // Fast food via Overpass (OSM)
    async function fetchFastFood(){
      var b=map.getBounds();
      var query='[out:json][timeout:25];(node["amenity"="fast_food"]('+b.getSouth()+','+b.getWest()+','+b.getNorth()+','+b.getEast()+'));out;';
      try{
        var res=await fetch('https://overpass-api.de/api/interpreter',{
          method:'POST',
          headers:{'Content-Type':'text/plain; charset=UTF-8'},
          body:query
        });
        if(!res.ok){ throw new Error('HTTP '+res.status); }
        var json=await res.json();
        layerFastFood.clearLayers();
        var els=json.elements||[];
        for(var j=0;j<els.length;j++){
          var el=els[j];
          if(!el || typeof el.lat!=='number' || typeof el.lon!=='number') continue;
          var tags=el.tags||{};
          var name=tags.name||tags.brand||'Fast food';
          L.marker([el.lat,el.lon],{icon:iconFastFood}).addTo(layerFastFood).bindPopup('<b>'+name+'</b>');
        }
        if(els.length===0){ showError('Nessun fast food trovato nell\'area attuale: zooma o sposta la mappa e riprova.'); }
      }catch(e){ showError('Errore caricando fast food: '+e.message); }
    }

    var btnFF=document.getElementById('fetchFastFoodBtn');
    if(btnFF) btnFF.onclick=fetchFastFood;

    var chkMon=document.getElementById('toggleMonuments');
    var chkFF=document.getElementById('toggleFastFood');
    if(chkMon) chkMon.onchange=function(e){ if(e.target.checked){ map.addLayer(layerMonuments);} else { map.removeLayer(layerMonuments);} };
    if(chkFF) chkFF.onchange=function(e){ if(e.target.checked){ map.addLayer(layerFastFood);} else { map.removeLayer(layerFastFood);} };

    // Lista laterale
    var list=document.getElementById('poiList');
    if(list){
      var html='';
      for(var k=0;k<POIS.length;k++){
        var p=POIS[k];
        html+="<div style='margin-bottom:.5rem'><b>"+p.name+"</b><br>"+p.desc+" "+(p.paid?"<span style='color:#b91c1c'>(a pagamento)</span>":"<span style='color:#15803d'>(gratis)</span>")+"</div>";
      }
      list.innerHTML=html;
    }
  })();
</script>
</body>
</html>
